---
title: Effective Query Keys
description:
date: 2021-06-13
banner: ./keys.jpeg
tags:
  - react
  - react-query
  - JavaScript
  - TypeScript
---

import Comments from 'components/Comments'
import Attribution from 'components/Attribution'

<img src="./keys.jpeg" />

<Attribution name="Chunli Ju" url="https://unsplash.com/@chunlea" />

- [#1: Practical React Query](practical-react-query)
- [#2: React Query Data Transformations](react-query-data-transformations)
- [#3: React Query Render Optimizations](react-query-render-optimizations)
- [#4: Status Checks in React Query](status-checks-in-react-query)
- [#5: Testing React Query](testing-react-query)
- [#6: React Query and TypeScript](react-query-and-type-script)
- [#7: Using WebSockets with React Query](using-web-sockets-with-react-query)
- <b>#8: Effective Query Keys</b>

---

[Query Keys](https://react-query.tanstack.com/guides/query-keys) are a very important core concept in React Query. They are necessary so that the library can internally cache your data correctly and refetch automatically when a dependency to your query changes. Lastly, it will allow you to interact with the Query Cache manually when needed, for example when updating data after a mutation or when you need to manually invalidate some queries.

Let's quickly have a look what these three points mean before I'll show you how I personally organize Query Keys to be able to do these things most effectively.

### Caching Data

Internally, the Query Cache is just a JavaScript object, where the keys are serialized Query Keys and the values are your Query Data plus meta information. The keys are hashed it in a [deterministic way](https://react-query.tanstack.com/guides/query-keys#query-keys-are-hashed-deterministically), so you can use Objects as well (On the top level, keys have to be strings or Arrays though).

The most important part is that keys need to be _unique_ for your queries. If React Query finds an entry for a key in the cache, it will use it. Please also be aware that you cannot use the same key for _useQuery_ _and_ _useInfiniteQuery_. There is, after all, only _one_ Query Cache, and you would share the data between these two. That is not good because infinite queries have a fundamentally different structure than "normal" queries.

```ts:title=dont-mix-keys
useQuery(['todos'], fetchTodos)

// üö® this won't work
useInfiniteQuery(['todos'], fetchInfiniteTodos)

// ‚úÖ choose something else instead
useInfiniteQuery(['infiniteTodos'], fetchInfiniteTodos)
```

### Automatic Refetching

> Queries are declarative.

This is a _very_ important concept that cannot be emphasized enough, and it's also something that might take some time to _click_. Most people think about queries, and especially refetching, in an _imperative_ way.

I have a query, it fetches some data. Now I click this button and I want to refetch, _but_ with parameters. Lots of folks attempt to go at it like this:

```jsx:title=imperative-refetch
function Component() {
  const { data, refetch } = useQuery(['todos'], fetchTodos)

  // ‚ùì how do I pass parameters to refetch ‚ùì
  return <Filters onApply={() => refetch(???)} />
}
```

The answer is: **You don't.**

That's not what _refetch_ is for - it's for refetching _with the same data_.

If you have some _state_ that changes your data, all you need to do is put it in the Query Key, because React Query will trigger a refetch automatically whenever the key changes. So when you want to apply your filters, change your _client state_:

```jsx:title=query-key-drives-the-query {2-3, 5}
function Component() {
  const [filters, setFilters] = React.useState()
  const { data } = useQuery(['todos', filters], fetchTodos)

  // ‚úÖ just set local state and let it "drive" the query
  return <Filters onApply={setFilters} />
}
```

I have a more in depth example in [#1: Practical React Query - Treat the query key like a dependency array](practical-react-query#treat-the-query-key-like-a-dependency-array).

### Manual Interaction

### Effective Query Keys


---

That's it for today. Feel free to reach out to me on [twitter](https://twitter.com/tkdodo)
if you have any questions, or just leave a comment below ‚¨áÔ∏è

<Comments withSeparator={false} />
